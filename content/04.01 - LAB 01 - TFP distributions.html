

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>LAB 1. TFP Distributions &#8212; Probabilistic Programming for Machine Learning</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spectre.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/xglobal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spectre-icons.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spectre-exp.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MBFEZ3PF64"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MBFEZ3PF64');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/04.01 - LAB 01 - TFP distributions';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-tf-udea-unal.png" class="logo__image only-light" alt="Probabilistic Programming for Machine Learning - Home"/>
    <script>document.write(`<img src="../_static/logo-tf-udea-unal.png" class="logo__image only-dark" alt="Probabilistic Programming for Machine Learning - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="outline.html">Course outline</a></li>
<li class="toctree-l1"><a class="reference internal" href="M1-videolist.html">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="M2-videolist.html">2 TF for Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="M3-videolist.html">3 Intuitions on Probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="M4-videolist.html">4 Tensorflow Probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="M5-videolist.html">5 Bayesian Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="M6-videolist.html">6 Variational Inference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/rramosp/ppdl/blob/main/content/04.01 - LAB 01 - TFP distributions.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/04.01 - LAB 01 - TFP distributions.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>LAB 1. TFP Distributions</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-1">Task 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-2">Task 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-3">Task 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-4">Task 4</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># init repo notebook
!git clone https://github.com/rramosp/ppdl.git &gt; /dev/null 2&gt; /dev/null
!mv -n ppdl/content/init.py ppdl/content/local . 2&gt; /dev/null
!pip install -r ppdl/content/requirements.txt &gt; /dev/null
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="lab-1-tfp-distributions">
<h1>LAB 1. TFP Distributions<a class="headerlink" href="#lab-1-tfp-distributions" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import inspect
from rlxmoocapi import submit, session

import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import tensorflow as tf
import tensorflow_probability as tfp
from scipy import stats

tfd = tfp.distributions
tfb = tfp.bijectors
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>course_id = &quot;ppdl.v1&quot;
endpoint = &quot;https://m5knaekxo6.execute-api.us-west-2.amazonaws.com/dev-v0001/rlxmooc&quot;
lab = &quot;L02.03.01&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>session.LoginSequence(
    endpoint=endpoint,
    course_id=course_id,
    lab_id=lab,
    varname=&quot;student&quot;
    );
</pre></div>
</div>
</div>
</div>
<section id="task-1">
<h2>Task 1<a class="headerlink" href="#task-1" title="Permalink to this heading">#</a></h2>
<p>Manually compute the pdf for different batch and event shapes, <strong>without</strong> using <code class="docutils literal notranslate"><span class="pre">tensorflow_probability</span></code>. You must use <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> to replicate the following distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def tf_random_normal_pdf(x, mu, cov):
    dist = tfd.MultivariateNormalTriL(
            loc=mu, scale_tril=tf.linalg.cholesky(cov)
            )
    return dist.log_prob(x)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sample_size = 5
batch_size = 3
event_size = 2

mu = (
        np.random.uniform(
            0, 1, size=(batch_size, event_size)
            )
        .astype(np.float32)
        )
cov = (
        np.random.uniform(
            1, 2, size=(event_size, event_size)
            )
        .astype(np.float32)
        )
cov = cov.dot(cov.T) # Ensuring PSD matrix
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x = (
        np.random.normal(
            loc=2, scale=5,
            size=(sample_size, batch_size, event_size)
            )
        .astype(np.float32)
        )
tf_random_normal_pdf(x, mu, cov)
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>We suggest using <code class="docutils literal notranslate"><span class="pre">scipy.stats.multivariate_normal</span></code>:</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def random_normal_pdf(x, mu, cov):
    ...
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>random_normal_pdf(x, mu, cov)
</pre></div>
</div>
</div>
</div>
<p>Test your code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>student.submit_task(namespace=globals(), task_id=&quot;T1&quot;);
</pre></div>
</div>
</div>
</div>
</section>
<section id="task-2">
<h2>Task 2<a class="headerlink" href="#task-2" title="Permalink to this heading">#</a></h2>
<p>The probability for a person to default on a credit depends on his income, and it is modeled with a distribution depending on the person’s age <span class="math notranslate nohighlight">\(x_i\)</span>, older people have flatter exponentials, meaning that as you get older the probability of default for higher incomes is higher than we you are younger.</p>
<p>Observe how we want to <strong>assign a distribution to each data point</strong></p>
<p>Make a function that, given a set of <span class="math notranslate nohighlight">\(x\in\mathbb{R}^n\)</span>, returns a batched distribution of <code class="docutils literal notranslate"><span class="pre">batch_size</span></code><span class="math notranslate nohighlight">\(=n\)</span> that assigns to each <span class="math notranslate nohighlight">\(x_i\)</span> a <span class="math notranslate nohighlight">\(\mathcal{N}(\mu_i, \sigma_i)\)</span> so that:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mu_i = 2 x_i\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma_i = \text{softplus}(x_i, \beta=\frac{1}{5}) = 5 \text{log}(\text{exp}(5 x) + 1)\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def credit_exp_dist(x):
    ...
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x = np.linspace(18, 60, 100)
dist = credit_exp_dist(x)
</pre></div>
</div>
</div>
</div>
<p>Run the next cell to visualize the scoring distribution for the learned distribution, it must look similar to the following image:</p>
<p><img alt="credit exponential distribution" src="https://raw.githubusercontent.com/rramosp/ppdl/main/content/local/imgs/credit_exp_dist.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>customers = [0, 25, 75, 99]
fig, ax = plt.subplots(2, 2, figsize=(10, 10))
sample = dist.sample(100000).numpy()
for i, customer in enumerate(customers):
    axi = ax[i // 2, i % 2]
    sns.kdeplot(sample[:, customer], ax=axi);
    axi.set_title(f&quot;Age: {int(x[customer])}, Score: ${sample[:, customer].mean():.2f}\\pm {sample[:, customer].std():.2f}$&quot;)
fig.tight_layout()
</pre></div>
</div>
</div>
</div>
<p>Test your code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>student.submit_task(namespace=globals(), task_id=&quot;T2&quot;);
</pre></div>
</div>
</div>
</div>
</section>
<section id="task-3">
<h2>Task 3<a class="headerlink" href="#task-3" title="Permalink to this heading">#</a></h2>
<p>Now, We want to implement a multivariate batch distribution, such that each data point is described by more variables, not only the person’s age. In this case, We’ll be using the age and the years of laboral experience of a given customer, you must implement:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(y_{i, 0} \sim \mathcal{N}(\mu_{i, 0}, \sigma_{i, 0})\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(y_{i, 1} \sim \mathcal{N}(\mu_{i, 1}, \sigma_{i, 1})\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{score_i} = y_{i, 0} + y_{i, 1}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\mu_{i, 0} = 2 x_i\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\mu_{i, 1} = -x_i\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma_{i, 0} = \text{softplus}(x_i, \beta=\frac{1}{5})\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma_{i, 1} = \text{softplus}(x_i, \beta=\frac{1}{2})\)</span>.</p></li>
</ul>
<p>Where <span class="math notranslate nohighlight">\(y_{i, 0}\)</span> is the credit score assigned to the age and <span class="math notranslate nohighlight">\(y_{i, 1}\)</span> is the credit score assigned to the years of experience for the <span class="math notranslate nohighlight">\(i\)</span>-th customer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def credit_mult_dist(x):
    ...
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>age = np.linspace(18, 60, 100)
experience = np.array([np.random.randint(0, i) for i in age])
X = np.vstack([age, experience]).T
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dist = credit_mult_dist(X)
print(dist)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>customers = [0, 25, 75, 99]
sample = dist.sample(10_000).numpy()
print(sample.shape)
</pre></div>
</div>
</div>
</div>
<p>Use the following cell to visualize the age distribution, the figure must look similar to this one:</p>
<p><img alt="Credit score and age" src="https://raw.githubusercontent.com/rramosp/ppdl/main/content/local/imgs/credit_age_dist.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots(2, 2, figsize=(10, 10))
for i, customer in enumerate(customers):
    sample_age = sample[..., 0]
    axi = ax[i // 2, i % 2]
    sns.kdeplot(sample_age[:, customer], ax=axi);
    axi.set_title(f&quot;Age: {int(X[customer, 0])}, Score: ${sample_age[:, customer].mean():.2f}\\pm {sample_age[:, customer].std():.2f}$&quot;)
fig.tight_layout()
</pre></div>
</div>
</div>
</div>
<p>Use the following cell to visualize the years of experience distribution, the figure must look similar to this one:</p>
<p><img alt="Credit and years of experience" src="https://raw.githubusercontent.com/rramosp/ppdl/main/content/local/imgs/credit_years_dist.png" />
Credit score distribution on years of experience</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots(2, 2, figsize=(10, 10))
for i, customer in enumerate(customers):
    sample_exp = sample[..., 1]
    axi = ax[i // 2, i % 2]
    sns.kdeplot(sample_exp[:, customer], ax=axi);
    axi.set_title(f&quot;Experience: {int(X[customer, 1])}, Score: ${sample_exp[:, customer].mean():.2f}\\pm {sample_exp[:, customer].std():.2f}$&quot;)
fig.tight_layout()
</pre></div>
</div>
</div>
</div>
<p>Use the following cell to visualize the overall score distribution, the figure must look similar to this one:</p>
<p><img alt="Overall credit score distribution" src="https://raw.githubusercontent.com/rramosp/ppdl/main/content/local/imgs/credit_overall_dist.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots(2, 2, figsize=(10, 10))
for i, customer in enumerate(customers):
    sample_overall = sample.sum(axis=-1)
    axi = ax[i // 2, i % 2]
    sns.kdeplot(sample_overall[:, customer], ax=axi);
    axi.set_title(f&quot;Age: {int(X[customer, 0])}, Experience: {int(X[customer, 1])}, Score: ${sample_overall[:, customer].mean():.2f}\\pm {sample_overall[:, customer].std():.2f}$&quot;)
fig.tight_layout()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>student.submit_task(namespace=globals(), task_id=&quot;T3&quot;);
</pre></div>
</div>
</div>
</div>
</section>
<section id="task-4">
<h2>Task 4<a class="headerlink" href="#task-4" title="Permalink to this heading">#</a></h2>
<p>In this task, you must implement the <code class="docutils literal notranslate"><span class="pre">tfb.Scale</span></code> bijector using <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and <code class="docutils literal notranslate"><span class="pre">numpy</span></code> <strong>without</strong> <code class="docutils literal notranslate"><span class="pre">tensorflow</span></code>.</p>
<p>Suppose We have the following distribution for a random variable <span class="math notranslate nohighlight">\(x\)</span>.</p>
<div class="math notranslate nohighlight">
\[
x \sim \mathcal{Beta}(a, b)
\]</div>
<p>And that we want to compute the logpdf of the following random variable:</p>
<div class="math notranslate nohighlight">
\[
y = f(x) = k \cdot x
\]</div>
<p>The PDF for y would be:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\text{log}(P_y(x)) = \text{log}(P_x(f^{-1}(x))) + \log \text{det}\Big[\frac{\partial}{\partial x} f^{-1}(x) \Big] \\
\end{split}\]</div>
<p>And in this case, since <span class="math notranslate nohighlight">\(x\)</span> is a scalar (single variable distribution):</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
f^{-1}(x) &amp;= \frac{x}{k}\\
\text{det}\Big[\frac{\partial}{\partial x} f^{-1}(x) \Big] &amp;= \frac{\partial}{\partial x} f^{-1}(x) = \frac{1}{k}
\end{align}
\end{split}\]</div>
<p>Finally:</p>
<div class="math notranslate nohighlight">
\[
\text{log}(P_y(y)) = \text{log}(P_x(\frac{x}{k})) + \text{log}(\frac{1}{k})
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># distribution parameters
a = np.random.uniform(0.1, 3)
b = np.random.uniform(0.1, 3)
k = np.random.uniform(1, 10)
</pre></div>
</div>
</div>
</div>
<p>Take a look at the expected bijector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dist = tfb.Scale(k)(tfd.Beta(a, b))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def scale_beta_logpdf(x, a, b, k):
    ...
</pre></div>
</div>
</div>
</div>
<p>The following subplots must look the same:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x = np.linspace(0, 1, 100)
fig, ax = plt.subplots(1, 2, figsize=(10, 7))
ax[0].plot(x, np.log(dist.prob(x)))
ax[1].plot(x, scale_beta_logpdf(x, a, b, k))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>student.submit_task(namespace=globals(), task_id=&quot;T4&quot;);
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-1">Task 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-2">Task 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-3">Task 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#task-4">Task 4</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Raúl Ramos / Universidad de Antioquia, Fabio González / Universidad Nacional de Colombia
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>